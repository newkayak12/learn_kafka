## Kafka Streams
카프카 스트림즈는 토픽에 적재된 데이터를 상태 기반(Stateful) 또는 비상태 기반(Stateless)으로 실시간 변환하여 다른 토픽에 적재하는 라이브러리다. 카프카의
스트림 데이터 처리를 위해서 [아파치 스파크(Spark)](https://aws.amazon.com/ko/what-is/apache-spark/), [아파치 플링크(Flink)](https://aws.amazon.com/ko/what-is/apache-flink/), [아파치 스톰(Storm)](), [플루언트디(Fluentd)]()와 같은 다양한 오픈소스 애플리케이션이
존재하지만 카프카 스트림즈를 사용해야하는 이유가 뭘까? 스트림즈는 카프카에서 공식 지원하는 라이브러리다. 카프카 버전이 올라갈 때마다 스트림즈 라이브러리도 같이 릴리즈 된다.
그래서 카프카 클러스터와 호환성이 높으며 스트림즈 처리에 필요한 편리한 기능들(신규 토픽 생성, 상태 저장, 데이터 조인 등)을 제공한다. 
스트림즈 애플리케이션 또는 카프카 브로커의 장애가 발생해도 장애 허용 시스템(fault tolerant system)을 가지고 있어서 데이터 처리 안정성이 매우 뛰어나다.
카프카 클러스터를 운영하면서 실시간 스트림 처리를 해야하는 경우에 스트림즈 애플리케이션으로 개발하는 것을 고려할 만하다. 


스트림즈 애플리케이션은 내부적으로 쓰레드를 1개 이상 생성할 수 있으며, 쓰레드는 1개 이상의 태스크를 가진다. 스트림즈의 태스크는 스트림즈 애플리케이션을 실행하면
생기는 데이터 처리 최소 단위다. 만약, 3개의 파ㅣ션으로 이뤄진 토픽을 처리하는 스트림즈 애플리케이션을 실행하면 내부에 3개의 테스크가 생긴다. 컨슈머의 병렬 처리를 위해
컨슈머 그룹으로 이뤄진 컨슈머 쓰레드를 여러 개 실행하는 것과 비슷하다고 볼 수 있다. 카프카 스트림즈는 컨슈머 쓰레드를 늘리는 방법과 동일하게 병렬처리를 위해 파티션과
스트림즈 쓰레드(또는 프로세스) 개수를 늘림으로써 처리량을 늘릴 수 있다. (실제 운영 환경에서는 안정적 운영을 위해 2 개 이상의 서버로 구성하여 스트림즈 애플리케이션을 운영한다.)

카프카 스트림즈의 구조와 사용 방법을 알기 위해서 토폴로지(topology)와 관련된 개념을 익혀야 한다. 카프카 스트림즈에서는 토폴로지를 이루는 노드를 '프로세서'라고 부르고
간선을 '스트림'이라고 부른다. 스트림은 토픽의 데이터를 뜻하는데 프로듀서와 컨슈머에서 활용했던 렠hㅋ드와 동일하다. 프로세서에는 `소스 프로세서`, `스트림 프로세서`, `싱크 프로세서` 3가지가 있다.

1. 소스 프로세서 : 데이터를 처리하기 위해 최초로 선언해야 하는 노드, 하나 이상의 토픽에서 데이터를 가져오는 역할
2. 스트림 프로세서 : 다른 프로세서가 반환한 데이터를 처리하는 역할. 변환, 분기처리와 같은 로직이 데이터 처리의 일종이라고 볼 수 있다. 
3. 싱크 프로세서 : 데이터를 특정 카프카 토픽으로 저장하는 역할을 하며, 스트림즈로 처리된 최종 종착지


````
               🌕                => 소스 프로세서 
             ↙    ↘
           🌕       🌕           => 스트림 프로세서
             ↘    ↙   ↘
               🌕        🌕      => 스트림 프로세서
               ↓         ↓           
               🌕        🌕      => 싱크 프로세서
    
````

방식은 스트림즈DSL과 프로세서 API 2가지로 개발 가능하다. DSL로 변환 로직을 어렵지 않게 작성할 수 있지만 만약 DSL에 없는 기능의 경우 프로세서 API로 구현할 수 있다.

1. 스트림즈DSL로 구현하는 데이터 처리 예시
    - 메시지 값을 기반으로 토픽 분기 처리 
    - 지난 10분간 들어온 데이터 개수 집계
    - 토픽과 다른 토픽의 결합으로 새로운 데이터 생성
   
2. 프로세서 API로 구현하는 예시
    - 메시지 값의 종류에 따라 토픽을 가변적으로 전송
    - 일정한 시간 간격으로 데이터 처리 


### StreamsDSL

### ProcessorAPI

